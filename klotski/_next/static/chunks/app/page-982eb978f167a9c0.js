(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{7883:(e,t,l)=>{Promise.resolve().then(l.bind(l,2047))},2047:(e,t,l)=>{"use strict";l.d(t,{default:()=>v});var a=l(5155),r=l(2115);let n={cao:{w:2,h:2},vertical:{w:1,h:2},horizontal:{w:2,h:1},soldier:{w:1,h:1}};function i(e){let t=Array.from({length:5},()=>Array.from({length:4},()=>null));for(let l of e){let{w:e,h:a}=n[l.type];for(let r=0;r<a;r+=1)for(let a=0;a<e;a+=1){let e=l.x+a,n=l.y+r;if(e<0||e>=4||n<0||n>=5)throw Error("Piece ".concat(l.id," is out of bounds"));if(null!==t[n][e])throw Error("Piece ".concat(l.id," overlaps with ").concat(t[n][e]));t[n][e]=l.id}}return t}function s(e){switch(e){case"up":return{dx:0,dy:-1};case"down":return{dx:0,dy:1};case"left":return{dx:-1,dy:0};case"right":return{dx:1,dy:0}}}function o(e,t,l){let a=e.find(e=>e.id===t);if(!a)return!1;let{dx:r,dy:o}=s(l),{w:d,h:c}=n[a.type],u=i(e);for(let e=a.y;e<a.y+c;e+=1)for(let t=a.x;t<a.x+d;t+=1){let l=t+r,n=e+o;if(l<0||l>=4||n<0||n>=5)return!1;let i=u[n][l];if(i&&i!==a.id)return!1}return!0}function d(e,t,l){if(!o(e,t,l))return null;let{dx:a,dy:r}=s(l);return e.map(e=>e.id===t?{...e,x:e.x+a,y:e.y+r}:e)}let c=JSON.parse('[{"id":"level-01","name":"指揮若定","layout":["YCCZ","YCCZ","cGGd","HabM","H..M"]},{"id":"level-02","name":"將擋曹營","layout":[".CC.","YCCZ","YHMZ","aHMb","GGcd"]},{"id":"level-03","name":"棄卒並進","layout":["YCCZ","YCCZ","cabd","HGGM","H..M"]},{"id":"level-04","name":"兵分三路","layout":["cCCd","YCCZ","YabZ","HGGM","H..M"]},{"id":"level-05","name":"左右佈兵","layout":["aCCb","cCCd","YZHM","YZHM",".GG."]},{"id":"level-06","name":"桃花園中","layout":["aCCb","YCCM","YZHM","cZHd",".GG."]},{"id":"level-07","name":"一路進軍","layout":["YCCa","YCCb","ZHMc","ZHMd",".GG."]},{"id":"level-08","name":"一路順風","layout":["YCCa","YCCb","ZGGH","ZcMH",".dM."]},{"id":"level-09","name":"圍而不礙","layout":["YCCa","YCCb","ZGGc","ZHMd",".HM."]},{"id":"level-10","name":"捷足先登","layout":["aCCb","cCCd",".GG.","YZHM","YZHM"]},{"id":"level-11","name":"插翅難飛","layout":["ZCCa","ZCCb","YYcd","HGGM","H..M"]},{"id":"level-12","name":"珠連同歸","layout":["ZCCH","ZCCH","aM.c","bM.d","YYGG"]},{"id":"level-13","name":"守口如瓶","layout":["aCCb","ZCCH","ZM.H","cM.d","YYGG"]},{"id":"level-14","name":"雙將擋路","layout":["ZCCa","ZCCb","HYYM","HGGM","c..d"]},{"id":"level-15","name":"橫馬當關","layout":["ZCCH","ZCCH","YYGG","aM.b","cM.d"]},{"id":"level-16","name":"層層設防","layout":["HCCM","HCCM","aZZb","cYYd",".GG."]},{"id":"level-17","name":"阻擋重重","layout":["aCCb","HCCM","HZZM","cYYd",".GG."]},{"id":"level-18","name":"兵擋將阻","layout":["aCCH","bCCH","MZZc","MYYd",".GG."]},{"id":"level-19","name":"阻塞要道","layout":["aCCc","bCCd","HMZZ","HMYY",".GG."]},{"id":"level-20","name":"甕中之鱉","layout":["HCCM","HCCM","YYZZ","aGGc","b..d"]},{"id":"level-21","name":"層巒疊嶂","layout":["HCCM","HCCM","aGGb","YYZZ","c..d"]},{"id":"level-22","name":"水洩不通","layout":["MCCa","MCCb","ZZHH","GGYY","c..d"]},{"id":"level-23","name":"四路進兵","layout":["aCCc","bCCd","M.HH","M.ZZ","GGYY"]},{"id":"level-24","name":"入地無門","layout":["MCCa","MCCb","cHHd","YYZZ",".GG."]},{"id":"level-25","name":"勇闖五關","layout":["aCCc","bCCd","HHMM","YYZZ",".GG."]}]'),u={C:{label:"曹操",theme:"red"},Z:{label:"張飛",theme:"blue"},Y:{label:"趙雲",theme:"yellow"},M:{label:"馬超",theme:"purple"},H:{label:"黃忠",theme:"lightBlue"},G:{label:"關羽",theme:"green"},a:{label:"兵",theme:"pink"},b:{label:"兵",theme:"pink"},c:{label:"兵",theme:"pink"},d:{label:"兵",theme:"pink"}},m=c.map(e=>({id:e.id,name:e.name,tip:e.tip,pieces:function(e){if(5!==e.length)throw Error("Each level must have 5 rows");let t=e.map(e=>{if(4!==e.length)throw Error("Each row must have ".concat(4," columns"));return e.split("")}),l=new Set,a=[];for(let e=0;e<t.length;e+=1)for(let r=0;r<4;r+=1){let n="".concat(r,",").concat(e),i=t[e][r];if("."===i||l.has(n))continue;if(!u[i])throw Error("Unknown symbol: ".concat(i));let s=[[r,e]],o=[];for(l.add(n);s.length>0;){let[e,a]=s.shift();for(let[r,n]of(o.push([e,a]),[[e+1,a],[e-1,a],[e,a+1],[e,a-1]])){if(r<0||r>=4||n<0||n>=t.length)continue;let e="".concat(r,",").concat(n);l.has(e)||t[n][r]!==i||(l.add(e),s.push([r,n]))}}let d=Math.min(...o.map(e=>e[0])),c=Math.max(...o.map(e=>e[0])),m=Math.min(...o.map(e=>e[1])),b=Math.max(...o.map(e=>e[1])),h=c-d+1,p=b-m+1,x=h*p;if(o.length!==x)throw Error("Piece '".concat(i,"' must be a full rectangle"));for(let e=m;e<=b;e+=1)for(let l=d;l<=c;l+=1)if(t[e][l]!==i)throw Error("Piece '".concat(i,"' has invalid shape"));let f=u[i];a.push({id:i,label:f.label,theme:f.theme,type:function(e,t){if(2===e&&2===t)return"cao";if(1===e&&2===t)return"vertical";if(2===e&&1===t)return"horizontal";if(1===e&&1===t)return"soldier";throw Error("Unsupported piece size ".concat(e,"x").concat(t))}(h,p),x:d,y:m})}return a.sort((e,t)=>e.id.localeCompare(t.id))}(e.layout)})),b={red:"bg-red-500 text-white",yellow:"bg-amber-300 text-stone-900",blue:"bg-blue-400 text-white",lightBlue:"bg-sky-300 text-slate-900",green:"bg-lime-400 text-slate-900",purple:"bg-violet-400 text-white",pink:"bg-pink-300 text-slate-900"},h=[{label:"↑",dir:"up"},{label:"←",dir:"left"},{label:"→",dir:"right"},{label:"↓",dir:"down"}],p="klotski-best-v1",x="klotski-last-stage-v1";function f(e){return e.map(e=>({...e}))}function C(e){let t=Math.floor(e/60).toString().padStart(2,"0"),l=(e%60).toString().padStart(2,"0");return"".concat(t,":").concat(l)}function g(e){let{level:t,index:l,active:r,onClick:i}=e;return(0,a.jsxs)("button",{type:"button",onClick:i,className:"shrink-0 rounded-lg border p-1 ".concat(r?"border-slate-800 bg-slate-100":"border-slate-200 bg-white"),"aria-label":"切換到第 ".concat(l+1," 關 ").concat(t.name),children:[(0,a.jsxs)("div",{className:"relative aspect-[4/5] w-14 overflow-hidden rounded border border-slate-300 bg-slate-800",children:[(0,a.jsx)("div",{className:"absolute inset-0 grid grid-cols-4 grid-rows-5",children:Array.from({length:20}).map((e,t)=>(0,a.jsx)("div",{className:"border border-slate-700/70"},t))}),t.pieces.map(e=>{var t;let l=n[e.type];return(0,a.jsx)("div",{className:"absolute rounded-[2px] border border-slate-800 ".concat(b[null!==(t=e.theme)&&void 0!==t?t:"pink"]),style:{left:"".concat(e.x/4*100,"%"),top:"".concat(e.y/5*100,"%"),width:"".concat(l.w/4*100,"%"),height:"".concat(l.h/5*100,"%")}},e.id)})]}),(0,a.jsx)("div",{className:"pt-1 text-[10px] font-semibold text-slate-700",children:String(l+1).padStart(2,"0")})]})}function v(){let e=(0,r.useMemo)(()=>m.map(e=>({id:e.id,result:function(e){try{let t=i(e.pieces).flat().filter(e=>null===e).length;return{valid:2===t,emptyCount:t,reason:2===t?void 0:"Expected 2 empty cells, got ".concat(t)}}catch(e){return{valid:!1,reason:e instanceof Error?e.message:"Unknown validation error"}}}(e)})).filter(e=>!e.result.valid),[]),[t,l]=(0,r.useState)(0),s=m[t],[c,u]=(0,r.useState)(f(s.pieces)),[v,y]=(0,r.useState)(null),[w,M]=(0,r.useState)(0),[Y,G]=(0,r.useState)(null),[H,Z]=(0,r.useState)(0),[N,j]=(0,r.useState)(!1),[k,S]=(0,r.useState)({}),E=(0,r.useRef)(null),I=(0,r.useRef)(c),P=(0,r.useRef)(w),_=(0,r.useRef)(Y);(0,r.useEffect)(()=>{I.current=c},[c]),(0,r.useEffect)(()=>{P.current=w},[w]),(0,r.useEffect)(()=>{_.current=Y},[Y]);let z=()=>{u(f(s.pieces)),y(null),M(0),j(!1),G(null),Z(0)};(0,r.useEffect)(()=>{try{let e=window.localStorage.getItem(p);e&&S(JSON.parse(e))}catch(e){S({})}},[]),(0,r.useEffect)(()=>{try{let e=window.localStorage.getItem(x);if(!e)return;let t=m.findIndex(t=>t.id===e);t>=0&&l(t)}catch(e){}},[]),(0,r.useEffect)(()=>{try{window.localStorage.setItem(x,s.id)}catch(e){}},[s.id]),(0,r.useEffect)(()=>{z()},[s.id]),(0,r.useEffect)(()=>{if(null===Y||N)return;let e=window.setInterval(()=>{Z(Math.floor((Date.now()-Y)/1e3))},1e3);return()=>window.clearInterval(e)},[Y,N]);let O=k[s.id],A=e=>{var t;let l=Date.now(),a=null!==(t=_.current)&&void 0!==t?t:l;null===_.current&&(_.current=l,G(l));let r=P.current+1,n=Math.floor((l-a)/1e3);if(u(e),M(r),Z(n),!function(e){let t=e.find(e=>"cao"===e.type);return!!t&&1===t.x&&3===t.y}(e))return;j(!0);let i=k[s.id];if(!i||r<i.moves||r===i.moves&&n<i.time){let e={...k,[s.id]:{moves:r,time:n}};S(e),window.localStorage.setItem(p,JSON.stringify(e))}},D=(e,t)=>{let l=null!=t?t:v;if(!l||N)return;let a=d(I.current,l,e);a&&A(a)},R=(e,t)=>{t.preventDefault(),t.currentTarget.setPointerCapture(t.pointerId),y(e),E.current={id:e,x:t.clientX,y:t.clientY,pointerId:t.pointerId}},U=(e,t)=>{let l=E.current;if(!l||l.id!==e||l.pointerId!==t.pointerId)return;let a=t.clientX-l.x,r=t.clientY-l.y;if(28>Math.abs(a)&&28>Math.abs(r))return;let n=Math.abs(a)>Math.abs(r)?a>0?"right":"left":r>0?"down":"up",i=d(I.current,e,n);i&&(E.current={id:e,x:t.clientX,y:t.clientY,pointerId:t.pointerId},A(i))},X=(e,t)=>{let l=E.current;if(E.current=null,t.currentTarget.hasPointerCapture(t.pointerId)&&t.currentTarget.releasePointerCapture(t.pointerId),!l||l.id!==e||l.pointerId!==t.pointerId){y(e);return}let a=t.clientX-l.x,r=t.clientY-l.y;28>Math.abs(a)&&28>Math.abs(r)&&y(e)};return(0,a.jsxs)("section",{className:"flex w-full flex-col gap-4",children:[(0,a.jsxs)("header",{className:"rounded-2xl bg-white/85 p-4 shadow-sm backdrop-blur",children:[(0,a.jsx)("h1",{className:"text-2xl font-extrabold tracking-tight text-slate-900",children:"華容道 Sliding Block Puzzle"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-slate-700",children:"用手指拖動棋子，每次移動一格。目標係將曹操移到最底中間出口。"})]}),e.length>0&&(0,a.jsxs)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:["關卡資料有錯：",e.map(e=>"".concat(e.id,"(").concat(e.result.reason,")")).join(", ")]}),(0,a.jsxs)("div",{className:"grid gap-4 lg:grid-cols-[1fr_320px]",children:[(0,a.jsx)("div",{className:"rounded-2xl bg-slate-900/95 p-3 shadow-lg",children:(0,a.jsxs)("div",{className:"relative mx-auto aspect-[4/5] w-full max-w-[420px] touch-none select-none overflow-visible rounded-xl border-2 border-slate-300 bg-slate-800",children:[(0,a.jsx)("div",{className:"absolute inset-0 grid grid-cols-4 grid-rows-5",children:Array.from({length:20}).map((e,t)=>(0,a.jsx)("div",{className:"border border-slate-700/70"},t))}),(0,a.jsx)("div",{className:"absolute -bottom-2 left-1/2 h-2 w-1/2 -translate-x-1/2 rounded-b-md bg-amber-400"}),c.map(e=>{var t;let l=n[e.type],r=v===e.id;return(0,a.jsx)("button",{type:"button",onPointerDown:t=>R(e.id,t),onPointerMove:t=>U(e.id,t),onPointerUp:t=>X(e.id,t),onPointerCancel:()=>{E.current=null},className:"absolute rounded-md border-2 border-slate-800 text-xs font-bold shadow transition ".concat(b[null!==(t=e.theme)&&void 0!==t?t:"pink"]," ").concat(r?"ring-2 ring-white":""),style:{left:"".concat(e.x/4*100,"%"),top:"".concat(e.y/5*100,"%"),width:"".concat(l.w/4*100,"%"),height:"".concat(l.h/5*100,"%")},children:e.label},e.id)})]})}),(0,a.jsxs)("aside",{className:"rounded-2xl bg-white/90 p-4 shadow-sm backdrop-blur",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:"關卡"}),(0,a.jsxs)("p",{className:"text-lg font-bold text-slate-900",children:[String(t+1).padStart(2,"0")," - ",s.name]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:"步數 / 時間"}),(0,a.jsxs)("p",{className:"text-lg font-bold text-slate-900",children:[w," / ",C(H)]})]})]}),(0,a.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>l(e=>0===e?m.length-1:e-1),className:"rounded-lg bg-slate-800 px-3 py-2 text-sm font-semibold text-white",children:"上一關"}),(0,a.jsx)("button",{type:"button",onClick:()=>l(e=>(e+1)%m.length),className:"rounded-lg bg-slate-800 px-3 py-2 text-sm font-semibold text-white",children:"下一關"}),(0,a.jsx)("button",{type:"button",onClick:z,className:"col-span-2 rounded-lg bg-amber-400 px-3 py-2 text-sm font-semibold text-slate-900",children:"重置本關"})]}),(0,a.jsxs)("div",{className:"mt-3 rounded-lg border border-slate-200 p-3",children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"方向控制（已選棋子）"}),(0,a.jsx)("div",{className:"mt-2 grid grid-cols-4 gap-2",children:h.map(e=>(0,a.jsx)("button",{type:"button",disabled:!v||!o(c,v,e.dir),onClick:()=>D(e.dir),className:"rounded-md border border-slate-300 bg-white py-2 text-base font-bold text-slate-800 disabled:cursor-not-allowed disabled:opacity-40",children:e.label},e.dir))}),(0,a.jsx)("p",{className:"mt-2 text-xs text-slate-500",children:"提示：輕觸棋子可選取，拖/掃可直接移動。"})]}),(0,a.jsxs)("div",{className:"mt-3 rounded-lg border border-slate-200 p-3 text-sm text-slate-700",children:[(0,a.jsx)("p",{children:"個人最佳："}),(0,a.jsx)("p",{className:"font-semibold",children:O?"".concat(O.moves," 步 / ").concat(C(O.time)):"未完成"})]}),N&&(0,a.jsxs)("div",{className:"mt-3 rounded-lg border border-emerald-300 bg-emerald-50 p-3 text-sm text-emerald-800",children:["過關！用咗 ",w," 步，時間 ",C(H),"。"]})]})]}),(0,a.jsxs)("div",{className:"rounded-xl bg-white/80 p-2 shadow-sm",children:[(0,a.jsx)("p",{className:"px-1 pb-2 text-xs font-semibold uppercase tracking-wide text-slate-500",children:"關卡縮圖"}),(0,a.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-1",children:m.map((e,r)=>(0,a.jsx)(g,{level:e,index:r,active:r===t,onClick:()=>l(r)},e.id))})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,517,358],()=>t(7883)),_N_E=e.O()}]);